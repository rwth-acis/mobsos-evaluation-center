<mat-sidenav-container>
  <mat-sidenav
    #snav
    [mode]="mobileQuery.matches ? 'over' : 'side'"
    [fixedInViewport]="mobileQuery.matches"
    [opened]="!mobileQuery.matches"
  >
    <ng-container *ngIf="(user$ | async)?.signedIn">
      <ng-container
        *ngIf="userGroups$ | async as groups; else groupsAreLoading"
      >
        <p *ngIf="groups.length === 0" id="noGroups">
          You are not part of any community yet. <br />
          Add a community too get started.
        </p>
        <!-- group selection -->
        <mat-form-field
          id="community-selection"
          *ngIf="groups.length > 0"
        >
          <mat-label>Community</mat-label>
          <mat-select
            [(ngModel)]="selectedGroupId"
            (selectionChange)="onGroupSelected($event.value)"
          >
            <mat-option
              class="mat-body-strong"
              *ngFor="let group of groups"
              [value]="group.id"
            >
              {{ group.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </ng-container>
      <mat-nav-list>
        <a mat-list-item (click)="openAddCommunityDialog()">
          <mat-icon matListIcon> group_add </mat-icon>
          {{ 'shared.pages.add-community' | translate }}
        </a>
        <mat-divider></mat-divider>
        <a
          mat-list-item
          routerLink="/welcome"
          routerLinkActive="active"
          (click)="menuItemClicked()"
        >
          <mat-icon matListIcon>home</mat-icon>
          Home
        </a>
        <a
          mat-list-item
          routerLink="/"
          routerLinkActive="active"
          (click)="menuItemClicked()"
        >
          <mat-icon matListIcon>trending_up</mat-icon>
          {{ 'shared.pages.success-modeling' | translate }}
        </a>
        <a
          *ngIf="expertMode$ | async"
          mat-list-item
          routerLink="/success-modeling/raw-edit"
          routerLinkActive="active"
          (click)="menuItemClicked()"
        >
          <mat-icon matListIcon>code</mat-icon>
          {{ 'shared.pages.raw-edit' | translate }}
        </a>
        <a
          *ngIf="
            environment.production === false && expertMode$ | async
          "
          mat-list-item
          routerLink="/query-visualization"
          routerLinkActive="active"
          (click)="menuItemClicked()"
        >
          <mat-icon matListIcon>show_chart</mat-icon>
          {{ 'shared.pages.query' | translate }}
        </a>
        <a mat-list-item [href]="mobsosSurveysUrl" target="_blank">
          <mat-icon matListIcon>open_in_browser</mat-icon>
          {{ 'shared.pages.manage-questionnaires' | translate }}
        </a>
        <a mat-list-item [href]="reqBazFrontendUrl" target="_blank">
          <mat-icon matListIcon>open_in_browser</mat-icon>
          {{ 'shared.pages.manage-requirements' | translate }}
        </a>
      </mat-nav-list>
    </ng-container>
    <footer>
      <mat-slide-toggle
        *ngIf="(user$ | async)?.signedIn"
        labelPosition="before"
        [checked]="expertMode$ | async"
        (change)="toggleExpertMode()"
      >
        {{ 'app.expert-mode.switch-label' | translate }}
      </mat-slide-toggle>
      <mat-action-list>
        <button
          mat-list-item
          (click)="useLanguage('en')"
          [disabled]="languageService.getCurrentLanguage() == 'en'"
        >
          English
        </button>
        <button
          mat-list-item
          (click)="useLanguage('de')"
          [disabled]="languageService.getCurrentLanguage() == 'de'"
        >
          Deutsch
        </button>
      </mat-action-list>
    </footer>
  </mat-sidenav>
  <mat-sidenav-content>
    <las2peer-frontend-statusbar
      id="las2peer-statusbar"
      service="{{ title }}"
      [attr.oidcAuthority]="environment.openIdAuthorityUrl"
      [attr.oidcclientid]="environment.openIdClientId"
      [attr.baseurl]="environment.las2peerWebConnectorUrl"
      oidcpopupsigninurl="oidc-signin"
      oidcpopupsignouturl="oidc-signout"
      oidcSilentSigninUrl="oidc-silent"
      [attr.useRedirect]="true"
      autoAppendWidget="true"
      (signed-in)="setUser($event.detail)"
      (signed-out)="logout()"
    >
      <button
        mat-icon-button
        id="menu-button"
        *ngIf="mobileQuery.matches"
        slot="left"
        (click)="snav.toggle()"
      >
        <mat-icon>menu</mat-icon>
      </button>
      <h2 slot="title">
        {{ mobileQuery.matches ? 'MobSOS EC' : title }}
      </h2>
    </las2peer-frontend-statusbar>
    <mat-progress-bar
      mode="indeterminate"
      *ngIf="isLoading"
    ></mat-progress-bar>
    <main>
      <mat-card class="noob-info" *ngIf="noobInfo">
        Watch
        <a
          class="yt-link"
          href="https://www.youtube.com/watch?v=HoXyG7Y7ovU&t=1s"
          target="_blank"
          rel="noopener noreferrer"
          >this video</a
        >
        to learn how to use the MobSOS EC.
        <div class="align-left">
          <button
            type="button"
            class="mr-3"
            mat-stroked-button
            (click)="dismissNoobInfo()"
          >
            Close
          </button>
        </div>
        <button
          type="button"
          mat-stroked-button
          color="warn"
          (click)="dismissNoobInfo(true)"
        >
          Don't show again
        </button>
      </mat-card>
      <router-outlet></router-outlet>
    </main>
    <footer id="footer">
      <a
        href="https://las2peer.org/"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          id="las2peer-logo"
          alt="las2peer-logo"
          src="assets/footer/las2peer.svg"
        />
      </a>
    </footer>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #groupsAreLoading>
  <mat-spinner
    color="accent"
    id="groupsLoadingIndicator"
    [diameter]="30"
  >
  </mat-spinner>
</ng-template>
